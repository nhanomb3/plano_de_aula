<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <title>Plano de Aula Mo√ßambicano</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    body {
      font-family: 'Times New Roman', Times, serif;
      font-size: 12px;
      background-color: #eef2f5;
      padding: 20px;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }
    html, body {
      -webkit-touch-callout: none;
      -webkit-user-drag: none;
    }
    .container {
      max-width: 1200px;
      margin: auto;
      background-color: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h1, h2, h3 {
      text-align: center;
      color: #2b5dab;
    }
    label {
      font-weight: bold;
      margin-top: 12px;
      display: block;
    }
    input[type="text"], input[type="password"] {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 12px;
      font-family: 'Times New Roman', Times, serif;
    }
    button {
      margin-top: 15px;
      padding: 10px 18px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 15px;
    }
    .btn-azul {
      background-color: #2b5dab;
      color: white;
    }
    .btn-cinza {
      background-color: #888;
      color: white;
      cursor: not-allowed;
    }
    .botoes {
      text-align: center;
    }
    .pagamento-section {
      display: none;
      margin-top: 20px;
      padding: 15px;
      background: #e6f0ff;
      border: 1px solid #a0c4ff;
      border-radius: 10px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #333;
      padding: 4px;
      vertical-align: top;
    }
    th {
      background-color: #e0e7ff;
      text-align: center;
    }
    .align-right {
      text-align: right;
    }
    .quadro-moral {
  background-color: white; /* muda para branco */
  padding: 15px;
  border: 1px dashed #bba100;
  border-radius: 8px;
  margin-top: 30px;
}
    }
    .rodape {
      text-align: center;
      font-style: italic;
      margin-top: 30px;
      color: #555;
    }
    textarea {
      width: 100%;
      min-height: 150px;
      font-family: 'Times New Roman', Times, serif;
      font-size: 12px;
      margin-top: 10px;
      padding: 10px;
    }
    .preliminares {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin-top: 20px;
    }
    @media print {
      .no-print {
        display: none !important;
      }
    }
  </style>
</head>
<body oncontextmenu="return false">
  <div class="container">
    <h1>Plano de Aula Mo√ßambicano</h1>
    <h3 style="margin-top: -10px; color: #444;">Por Edmilson Bartolomeu Nhanombe</h3>

    <label>Nome da Escola:</label><input type="text" id="escola" />
    <label>Data:</label><input type="text" id="data" placeholder="dd/mm/aaaa"/>
    <label>Nome do Professor:</label><input type="text" id="professor" />
    <label>Disciplina:</label><input type="text" id="disciplina" />
    <label>Classe:</label><input type="text" id="classe" />
    <label>Unidade Tem√°tica:</label><input type="text" id="unidade" />
    <label>Tema da Aula:</label><input type="text" id="tema" />

    <div class="preliminares">
      <div><label>Turma:</label><input type="text" id="turma" /></div>
      <div><label>N¬∫ de Alunos:</label><input type="text" id="numAlunos" class="align-right" /></div>
      <div><label>Per√≠odo:</label><input type="text" id="periodo" /></div>
      <div><label>N¬∫ de Li√ß√£o:</label><input type="text" id="numLicao" /></div>
      <div><label>Tipo de Aula:</label><input type="text" id="tipoAula" /></div>
    </div>

    <div class="botoes">
      <button class="btn-azul" onclick="gerarPlano()">üìò Gerar Plano</button>
      <button class="btn-azul" onclick="mostrarPagamento()">üì• Gerar PDF</button>
    </div>

    <div id="pagamentoOpcao" class="pagamento-section">
      <p><strong>Escolha o tipo de pagamento:</strong></p>
      <button class="btn-azul" onclick="escolherPagamento('diario')">Pagamento Di√°rio (15 MZN) - E-mola: 876393961</button>
      <button class="btn-azul" onclick="escolherPagamento('mensal')">Pagamento Mensal (150 MZN) - E-mola: 876393961</button>
      <p style="margin-top:15px;"><strong>Introduza o c√≥digo de acesso:</strong></p>
<input type="password" id="codigoAcesso" placeholder="Digite o c√≥digo enviado" />
<div id="mensagemCodigo" style="margin-top:8px; font-weight:bold; color:#b00;"></div>
<button class="btn-azul" onclick="validarCodigo()">‚úÖ Confirmar C√≥digo</button>
<p style="margin-top: 15px; font-weight:bold;">Em caso de dificuldades contacte: 876393961 ou 834890828</p>
    </div>

    <div id="planoPDF"></div>
<div id="quadroPDF" style="page-break-before: always;"></div>
    <div class="no-print">
      <button class="btn-azul" onclick="buscarExplicacao()">üîç Buscar Explica√ß√£o com ChatGPT</button>
      <textarea id="campoEdicaoQuadro" placeholder="Cole ou escreva aqui a explica√ß√£o gerada..."></textarea>
      <button class="btn-azul" onclick="salvarQuadroMoral()">üíæ Salvar Explica√ß√£o</button>
    </div>

    <div class="rodape">
  Graduado no IFP de Morrumbala <br/>
  <button class="btn-azul" onclick="alert('Em caso de dificuldades contacte: 876393961 ou 834890828')">Contactar Suporte</button>
  <br/><br/>
  üîó <a href="https://whatsapp.com/channel/0029VbBdJD0BFLgNjJGmUO2O" target="_blank" style="color:#2b5dab; font-weight:bold; text-decoration:none;">
    Canal de WhatsApp para mais informa√ß√µes
  </a>
</div>
  </div>

<script>
  let tipoPagamentoSelecionado = null;

  document.addEventListener("keydown", function(e) {
    if (e.key === "PrintScreen") {
      navigator.clipboard.writeText("Captura bloqueada.");
      alert("Captura de ecr√£ bloqueada.");
      e.preventDefault();
    }
  });

  function mostrarPagamento() {
    document.getElementById("pagamentoOpcao").style.display = "block";
  }

function validarCodigo() {
  const codigo = document.getElementById("codigoAcesso").value.trim();
  const msg = document.getElementById("mensagemCodigo");
  msg.style.color = "#b00"; // cor vermelha por padr√£o
  msg.innerText = ""; // limpa mensagens anteriores

  if (!codigo) {
    msg.innerText = "‚ö†Ô∏è Digite o c√≥digo de acesso.";
    return;
  }

  fetch(`https://script.google.com/macros/s/AKfycbwmLMNr5u8OIUcIcTgDHzP-_d_8IrqceUN9detVTTNIl1P7HzXpCpJiiD50ojMdjGbGmw/exec?codigo=${encodeURIComponent(codigo)}`)
    .then(r => r.json())
    .then(data => {
      if (data.status === "ok") {
        msg.style.color = "green";
        msg.innerText = `‚úÖ C√≥digo v√°lido! PDFs restantes: ${data.restantes} | V√°lido at√©: ${data.data_final}`;
        gerarPlano();
        baixarPDF();
        document.getElementById("pagamentoOpcao").style.display = "none";
        document.getElementById("codigoAcesso").value = "";
      } else if (data.status === "expirado") {
        msg.innerText = "‚ùå C√≥digo expirado. Contacte o administrador.";
      } else if (data.status === "limite") {
        msg.innerText = "‚ùå Limite de PDFs atingido para este c√≥digo.";
      } else if (data.status === "nao_encontrado") {
        msg.innerText = "‚ùå C√≥digo n√£o encontrado. Verifique e tente novamente.";
      } else {
        msg.innerText = "‚ö†Ô∏è Ocorreu um erro na valida√ß√£o. Tente novamente.";
      }
    })
    .catch(err => {
      console.error(err);
      msg.innerText = "‚ö†Ô∏è Erro de conex√£o com o servidor. Tente novamente.";
    });
}

  function gerarPlano() {
    const get = id => document.getElementById(id).value.trim();
    const escola = get("escola"), data = get("data"), professor = get("professor"),
          disciplina = get("disciplina"), classe = get("classe"), tema = get("tema"), unidade = get("unidade"),
          turma = get("turma"), numAlunos = get("numAlunos"), periodo = get("periodo"),
          numLicao = get("numLicao"), tipoAula = get("tipoAula");

    const objGeral = `Desenvolver compet√™ncias relacionadas com o tema "${tema}".`;
    const objCog = `Compreender e explicar o conte√∫do sobre "${tema}".`;
    const objPsi = `Aplicar os conhecimentos sobre "${tema}".`;
    const objAfet = `Valorizar a import√¢ncia de "${tema}" no dia a dia.`;

    document.getElementById("planoPDF").innerHTML = `
      <h2>üìò Plano de Aula</h2>
      <div style="display: flex; justify-content: space-between; align-items: flex-start;">
        <div>
          <p><strong>Escola:</strong> ${escola}</p>
          <p><strong>Professor:</strong> ${professor}</p>
          <p><strong>Unidade Tem√°tica:</strong> ${unidade}</p>
          <p><strong>Tema:</strong> ${tema}</p>
          <p><strong>Tipo de Aula:</strong> ${tipoAula}</p>
        </div>
        <div style="text-align: right; min-width: 300px;">
          <p><strong>Classe:</strong> ${classe}</p>
          <p class="align-right"><strong>Turma:</strong> ${turma}</p>
          <p class="align-right"><strong>N¬∫ de Alunos:</strong> ${numAlunos}</p>
          <p><strong>Li√ß√£o n¬∫:</strong> ${numLicao}</p>
          <p><strong>Dura√ß√£o:</strong> 45 minutos</p>
          <p><strong>Data:</strong> ${data}</p>
        </div>
      </div>
      <p contenteditable="true"><strong>Objetivo Geral:</strong> ${objGeral}</p>
<p contenteditable="true"><strong>Objetivo Cognitivo:</strong> ${objCog}</p>
<p contenteditable="true"><strong>Objetivo Psicomotor:</strong> ${objPsi}</p>
<p contenteditable="true"><strong>Objetivo Afetivo:</strong> ${objAfet}</p>

<table border="1" cellspacing="0" cellpadding="5">
  <tr>
    <th rowspan="2" contenteditable="true">Tempo</th>
    <th rowspan="2" contenteditable="true">Conte√∫do</th>
    <th rowspan="2" contenteditable="true">Fun√ß√£o Did√°tica</th>
    <th rowspan="2" contenteditable="true">Meios de Ensino</th>
    <th rowspan="2" contenteditable="true">M√©todo</th>
    <th colspan="2" contenteditable="true">Atividade</th>
  </tr>
  <tr>
    <th contenteditable="true">Professor</th>
    <th contenteditable="true">Aluno</th>
  </tr>
  <tr>
    <td contenteditable="true">00‚Äì05 min</td>
    <td contenteditable="true">Sauda√ß√£o e organiza√ß√£o</td>
    <td contenteditable="true">Introdu√ß√£o e motiva√ß√£o</td>
    <td contenteditable="true">Quadro e giz</td>
    <td contenteditable="true">Expositivo</td>
    <td contenteditable="true">- Sa√∫da os alunos<br>- Verifica ambiente<br>- Apresenta o tema: ${tema}</td>
    <td contenteditable="true">- Responde √† sauda√ß√£o<br>- Anota o tema</td>
  </tr>
  <tr>
    <td contenteditable="true">05‚Äì20 min</td>
    <td contenteditable="true">Explora√ß√£o do tema: ${tema}</td>
    <td contenteditable="true">Media√ß√£o e assimila√ß√£o</td>
    <td contenteditable="true">Quadro e livro</td>
    <td contenteditable="true">Elabora√ß√£o conjunta</td>
    <td contenteditable="true">- Faz perguntas<br>- Explica o conte√∫do com exemplos visuais<br>- Relaciona com o quotidiano</td>
    <td contenteditable="true">- Participa<br>- Relaciona o tema<br>- Regista exemplos</td>
  </tr>
  <tr>
    <td contenteditable="true">20‚Äì35 min</td>
    <td contenteditable="true">Exerc√≠cios pr√°ticos</td>
    <td contenteditable="true">Dom√≠nio e consolida√ß√£o</td>
    <td contenteditable="true">Caderno</td>
    <td contenteditable="true">Trabalho independente</td>
    <td contenteditable="true">- Prop√µe exerc√≠cios<br>- Circula pela sala</td>
    <td contenteditable="true">- Resolve os exerc√≠cios<br>- Solicita ajuda</td>
  </tr>
  <tr>
    <td contenteditable="true">35‚Äì45 min</td>
    <td contenteditable="true">Avalia√ß√£o</td>
    <td contenteditable="true">Controlo e avalia√ß√£o</td>
    <td contenteditable="true">Folha/caderno</td>
    <td contenteditable="true">Trabalho independente</td>
    <td contenteditable="true">- Aplica avalia√ß√£o<br>- Recolhe respostas</td>
    <td contenteditable="true">- Responde individualmente</td>
  </tr>
</table>`;
  }

  function buscarExplicacao() {
    const tema = document.getElementById("tema").value.trim();
    if (!tema) {
      alert("Escreva primeiro o tema da aula para pesquisar no ChatGPT.");
      return;
    }
    const url = `https://chat.openai.com/?q=Explica+o+tema+%22${encodeURIComponent(tema)}%22+com+exerc%C3%ADcios+e+exemplos`;
    window.open(url, "_blank");
  }

  function salvarQuadroMoral() {
  let texto = document.getElementById("campoEdicaoQuadro").value.trim();
  if (!texto) {
    alert("Por favor, escreva ou cole a explica√ß√£o primeiro.");
    return;
  }

  // ‚úÖ 1. Remover introdu√ß√µes t√≠picas de IA (frases no in√≠cio ou no meio)
  const regexIntro = [
    /^claro.*$/gim,
    /^aqui est√°.*$/gim,
    /^se quiseres.*$/gim,
    /^posso ajustar.*$/gim,
    /^segue abaixo.*$/gim,
    /^com exemplos.*$/gim,
    /^veja abaixo.*$/gim,
    /^explica√ß√£o completa.*$/gim,
    /^apresento.*$/gim,
    /^criei uma explica√ß√£o.*$/gim,
    /^preparado.*$/gim,
    /quer que organize.*$/gim,
    /organizo.*$/gim,
    /posso adaptar.*$/gim
  ];
  regexIntro.forEach(re => {
    texto = texto.replace(re, "");
  });

  // ‚úÖ 2. Remover emojis e s√≠mbolos
  texto = texto
    .replace(/[\u{1F600}-\u{1F64F}]/gu, "")
    .replace(/[\u{1F300}-\u{1F5FF}]/gu, "")
    .replace(/[\u{1F680}-\u{1F6FF}]/gu, "")
    .replace(/[\u{2600}-\u{26FF}]/gu, "")
    .replace(/[\u{2700}-\u{27BF}]/gu, "")
    .replace(/[*#‚Ä¢\-‚úì‚úî‚úó‚úò‚ñ∫¬´¬ª‚Äπ‚Ä∫]/g, "");

  // ‚úÖ 3. Remover m√∫ltiplos espa√ßos/linhas
  texto = texto.replace(/\s{2,}/g, " ").replace(/\n{2,}/g, "\n");

  // ‚úÖ 4. Formatar t√≠tulos automaticamente
  texto = texto.replace(
    /^([A-Z√Å√â√ç√ì√ö√Ç√ä√î√É√ï√á][^\n]{0,80})$/gim,
    "<p style='font-family: \"Times New Roman\"; font-size: 12pt; margin-bottom: 8px; font-weight: bold;'>$1</p>"
  );

  // ‚úÖ 5. Converter quebras em <br>
  const textoFormatado = texto.replace(/\n/g, "<br>");

  // ‚úÖ 6. Inserir no quadro final
  document.getElementById("quadroPDF").innerHTML = `
  <div class="quadro-moral"
       style="font-family:'Times New Roman'; font-size:12pt; border:1px solid #ccc; padding:8px;">
       
    <h3 style="margin-bottom:8px; font-family:'Times New Roman'; font-size:12pt;">
      üìö Quadro Moral
    </h3>

    <!-- ‚úÖ SOMENTE ESTE BLOCO √â EDIT√ÅVEL -->
    <div id="conteudoMoral"
         contenteditable="true"
         style="outline:none; min-height:100px;">
      ${textoFormatado}
    </div>
    
  </div>
`;
  }

  function baixarPDF() {
    const plano = document.getElementById("planoPDF");
    const quadro = document.getElementById("quadroPDF");
    const data = document.getElementById("data").value.trim().replace(/[\/]/g, "-") || 'sem-data';

    // Criar um container tempor√°rio para o PDF com plano e quadro em p√°ginas separadas
    const pdfContainer = document.createElement("div");

    // Clonar plano e adicionar ao container
    const planoClone = plano.cloneNode(true);
    pdfContainer.appendChild(planoClone);

    // Clonar quadro e adicionar ao container
    const quadroClone = quadro.cloneNode(true);
    pdfContainer.appendChild(quadroClone);

    // Configurar html2pdf com margens recomendadas e formato A4 landscape
    // Margens em mm
const marginTop = 30;
const marginLeft = 30;
const marginBottom = 20;
const marginRight = 20;

html2pdf().set({
  margin: [marginTop, marginLeft, marginBottom, marginRight], // top, left, bottom, right
  filename: `Plano de Aula MZ - ${data}.pdf`,
  image: { type: 'jpeg', quality: 0.98 },
  html2canvas: { 
    scale: 2,        // aumenta a qualidade
    useCORS: true,   // para imagens externas
    scrollY: 0       // garante que capture do topo do container
  },
  jsPDF: { unit: 'mm', format: 'a4', orientation: 'landscape' }
})
.from(pdfContainer)
.save();
  }
</script>
</body>
</html>
